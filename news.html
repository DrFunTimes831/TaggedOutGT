<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>News â€“ TaggedOut</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

  <!-- Alpine.js (with collapse plugin) -->
  <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans p-6">
  <h1 class="text-4xl font-bold text-yellow-400 text-center mb-8">ðŸ“° News</h1>

  <div id="news-container" class="max-w-3xl mx-auto space-y-4"></div>

  <script>
    async function fetchCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      const lines = text.split('\n').filter(Boolean);
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        return Object.fromEntries(headers.map((h, i) => [h, values[i]]));
      });
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRS_swMJX_9SGQlxxfb9CFF7uj7pJTjScCmrNEoUtT1M-SMWMQe11z0ZtYzjCxEh8WmF9tn_LGQeCoW/pub?output=csv";
      const newsData = await fetchCSV(url);
      const container = document.getElementById("news-container");

      if (!newsData || newsData.length === 0) {
        container.innerHTML = "<p class='text-gray-400'>No news yet.</p>";
        return;
      }

      newsData.reverse().forEach(item => {
        const section = document.createElement("div");
        section.innerHTML = `
          <div x-data="{ open: false }" class="bg-gray-800 rounded shadow p-4">
            <button class="w-full text-left text-lg font-semibold text-yellow-300 hover:text-yellow-200 flex justify-between"
                    @click="open = !open">
              ${item.title || "Untitled"}
              <span x-text="open ? 'â–²' : 'â–¼'"></span>
            </button>
            <div x-show="open" x-collapse.duration.300ms x-cloak class="mt-2 text-sm text-gray-300 transition-all">
              <p class="mb-1"><em>${item.date}</em></p>
              <p>${item.message}</p>
            </div>s
          </div>
        `;
        container.appendChild(section);
      });
    });
  </script>
</body>
</html>
